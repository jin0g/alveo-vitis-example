# バースト転送最適化テスト

このディレクトリには、PCIeバス経由のデータ転送スループットを最適化するためのテスト実装が含まれています。異なるビット幅（32, 64, 128, 256, 512, 1024ビット）とバースト長（256, 512, 1024）の組み合わせでHLSカーネルを実装し、実機上でのスループットを測定します。

## 目的

PCIe 3.0 x16の理論的な最大帯域幅（約16GB/s）に近づけるために、最適なビット幅とバースト長の組み合わせを見つけることを目的としています。

## 実装内容

- 各ビット幅（32, 64, 128, 256, 512, 1024）に対応するHLSカーネル
- m_axiインターフェースを使用したバースト転送
- 単純な+1加算処理をパイプライン化
- 異なるバースト長（256, 512, 1024）でのテスト
- 実機向けxclbinのビルド
- スループット測定
- C++テストハーネスとPythonテストスクリプトによる自動テスト

## 環境要件

- Xilinx Alveo カード
- Xilinx Vitis
- Xilinx XRT（Xilinx Runtime）

環境変数が正しく設定されていることを確認してから、ビルドを実行してください。
XRT環境のセットアップが必要な場合は、適切なスクリプトを実行してください。

## ビルド方法

```bash
# すべてのビット幅のカーネルをビルド
make all

# 特定のビット幅のカーネルのみをビルド（例: 32ビット）
make burst_32.xclbin

# テスト実行ファイルをビルド
make burst_test_hw
```

## テスト実行方法

### 標準テストハーネス（すべてのビット幅）

```bash
# 32ビット幅、バースト長256でテスト実行
./burst_test_hw burst_32.xclbin 32 256

# 64ビット幅、バースト長512でテスト実行
./burst_test_hw burst_64.xclbin 64 512

# Pythonテストの実行（すべての組み合わせを自動的にテスト）
python3 burst_python_test_hw.py
```

### 簡易テストハーネス（32ビットと64ビットのみ）

ap_int.hに依存しない簡易テストハーネスも用意しています。32ビットと64ビットのカーネルのみをテストできます。

```bash
# 32ビット幅、バースト長256でテスト実行
./burst_simple_hw burst_32.xclbin 32 256

# 64ビット幅、バースト長512でテスト実行
./burst_simple_hw burst_64.xclbin 64 512

# 簡易Pythonテストの実行（32ビットと64ビットのみ）
python3 burst_simple_python_hw.py
```

## テスト結果

以下は、各ビット幅とバースト長の組み合わせでのテスト結果です。

| ビット幅 | バースト長 | スループット (M Ops/sec) | 帯域幅 (MB/s) |
|---------|-----------|------------------------|------------|
| 32      | 256       | TBD                    | TBD        |
| 32      | 512       | TBD                    | TBD        |
| 32      | 1024      | TBD                    | TBD        |
| 64      | 256       | TBD                    | TBD        |
| 64      | 512       | TBD                    | TBD        |
| 64      | 1024      | TBD                    | TBD        |
| 128     | 256       | TBD                    | TBD        |
| 128     | 512       | TBD                    | TBD        |
| 128     | 1024      | TBD                    | TBD        |
| 256     | 256       | TBD                    | TBD        |
| 256     | 512       | TBD                    | TBD        |
| 256     | 1024      | TBD                    | TBD        |
| 512     | 256       | TBD                    | TBD        |
| 512     | 512       | TBD                    | TBD        |
| 512     | 1024      | TBD                    | TBD        |
| 1024    | 256       | TBD                    | TBD        |
| 1024    | 512       | TBD                    | TBD        |
| 1024    | 1024      | TBD                    | TBD        |

## 考察

PCIe 3.0 x16の理論的な最大帯域幅は約16GB/sです。異なるビット幅とバースト長の組み合わせでテストを行うことで、最適な設定を見つけることができます。

一般的に、以下の傾向が予想されます：

1. ビット幅が大きいほど、単位時間あたりに転送できるデータ量が増加
2. バースト長が長いほど、オーバーヘッドが減少し効率が向上
3. ただし、ハードウェアリソースの制約により、最適な設定は環境によって異なる

実際のテスト結果に基づいて、最適な設定を特定し、PCIeバス帯域幅を最大限に活用する方法を見つけることが目標です。
